# Установки для разработки

Документ задаёт общие правила работы над проектом: как пишем код, как проверяем логику и что держим в голове при любом изменении. Используется и при ручной разработке, и при работе с AI (Cursor и др.).

---

## Роли при разработке

### Программист (условно 20 лет стажа)

- Владеет стеком: Java 17, Spring Boot 3, JPA/Hibernate, PostgreSQL, Telegram Bot API.
- Пишет код, пригодный к продакшену: без временных костылей, с учётом транзакций, границ (null, пустые коллекции), производительности и безопасности.
- Следует принятым в проекте паттернам (сервисы, репозитории, конфиг) и не вводит лишние абстракции без явной необходимости.

### Аналитик (условно 15 лет стажа)

- Проверяет **всю логику**: сценарии пользователя, пошаговые сценарии, граничные случаи.
- Следит за целостностью данных: кто к чему имеет доступ, что происходит при отсутствии данных, при дубликатах, при неверном вводе.
- Оценивает, что может сломаться при росте нагрузки или при изменении требований (мультитенантность, новые роли).

При любом изменении кода или сценариев обе роли учитываются: и реализация (программист), и корректность и полнота логики (аналитик).

---

## Обязательные принципы

### 1. Контекст команды (team_id)

- Любой доступ к данным (игроки, матчи, статистика и т.д.) выполняется **только в контексте команды**.
- Не выбирать и не обновлять сущности без проверки принадлежности к команде пользователя (подготовка к мультитенантности).
- В сервисах всегда явно передаётся или выводится `teamId`; в репозиториях при необходимости — методы вида `findByTeamId(...)`.

### 2. Транзакции и работа с БД

- Бизнес-операции в сервисах — в транзакциях (`@Transactional`).
- Связь с `Team` при создании связанных сущностей — через `teamRepository.getReferenceById(teamId)`, не через `new Team()` с одним лишь `id`.

### 3. Ввод пользователя

- Весь ввод из Telegram (команды, текст, кнопки) — валидировать: trim, проверка на пустоту, числа в нужных полях.
- При ошибке — отправлять пользователю **понятное сообщение** (на русском), не допускать необработанных исключений и «500» без ответа в чат.

### 4. Логика сценариев

Для каждого сценария (создание команды, добавление игрока, матч, ввод результата и т.д.) явно учитывать:

- что происходит, если данных нет (пустой состав, нет запланированных матчей);
- что происходит при неверном формате (лишние/недостающие аргументы, не число);
- что видит пользователь после успешного действия и после ошибки.

### 5. Минимализм

- Не добавлять новые зависимости и слои абстракций «на будущее» без задачи из плана или явного требования.
- Документация и комментарии — по мере необходимости, без дублирования очевидного.

---

## Стиль и структура кода

- **Язык:** Java 17, Spring Boot 3. Имена сущностей, методов, переменных — по-английски. Сообщения пользователю и при необходимости комментарии — по-русски.
- **Пакеты:**  
  `config`, `model`, `repository`, `service`, `telegram`, `controller`, `util`.  
  Новый код размещается в соответствующем пакете без лишней вложенности.
- **Сервисы:** чёткий контракт (вход, выход, возможные исключения). Репозитории — только доступ к данным (Spring Data JPA), без бизнес-логики.

---

## Чек-лист перед коммитом / PR

- [ ] Логика сценария проверена от начала до конца (в т.ч. пустые данные, неверный ввод).
- [ ] Нет захардкоженных секретов; чувствительные данные — из конфига или переменных окружения.
- [ ] Изменения схемы БД — только через новые миграции Flyway; уже применённые скрипты не меняем.
- [ ] Новый код следует установкам из этого файла и из `.cursor/rules/` (если используются).

---

## Связанные файлы

- **План и этапы:** [План разработки](План%20разработки), [ROADMAP.md](ROADMAP.md).
- **Правила для AI:** [.cursor/rules/development-standards.mdc](.cursor/rules/development-standards.mdc) (при использовании Cursor).
