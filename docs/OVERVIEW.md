# Цифровой менеджер — общая картина и план развития

## Что сделано (общая картина)

**Цифровой менеджер** — Telegram-бот для баскетбольной команды. Один чат = одна команда: менеджер создаёт команду по `/start`, добавляет игроков и матчи, вводит результаты; бот генерирует посты и картинки, напоминает о матчах и собирает явку.

### Реализованный функционал

| Область | Что сделано |
|--------|--------------|
| **Ядро** | Spring Boot 3, PostgreSQL, Flyway, JPA (Team, Player, Match). Везде фильтрация по `team_id`. |
| **Бот** | `/start` → создание команды по следующему сообщению. Меню (кнопки): Состав, Добавить игрока, Новый матч, Ввести результат, Опрос, Долги. |
| **Игроки** | Добавление (/addplayer Имя Номер), состав с фильтром по статусу. Статусы: активен, травма, отпуск, не оплатил (`/setstatus`, `/roster активные` и т.д.). |
| **Матчи** | Создание (/newmatch Соперник), ввод результата (/result наши их). Сохранение в БД, статусы матча (запланирован / завершён / отменён). |
| **Контент** | После ввода результата — текст поста по шаблону и карточка 1080×1080 PNG в чат. Кнопка «Опубликовать в канал» и команда `/setchannel ID` для привязки канала. |
| **Явка и финансы** | Опрос на игру (/poll текст) — Еду / Не еду / Опоздаю. Долги: `/debt`, `/setdebt Имя Сумма`. |
| **Напоминания** | Планировщик (каждые 15 мин): за 24 ч — опрос «Кто едет?», за 3 ч — напоминание о матче, после матча — напоминание ввести `/result`. |
| **Роли** | В боте: ADMIN, CAPTAIN, PLAYER; меню кнопок и список команд в «Команды» зависят от роли (игрок не видит «Приглашение», ввод результата и т.д.). В веб-админке страница «Участники» — имя (редактируемое), контакт @username, смена ролей. Доступ в бот без приглашения задаётся по **@username** в Настройках. |

### Технический стек и инфраструктура

- **Backend:** Java 17, Spring Boot 3.2, Spring Data JPA, Flyway.
- **БД:** PostgreSQL, миграции V1–V8 (схема, долги/канал, статусы, напоминания, роли, приглашения, system_settings, telegram_username/display_name, admin_telegram_username).
- **Telegram:** telegrambots (long polling), один бот, один клиент (бин) для бота и планировщика.
- **Запуск:** локально (Maven), Docker (postgres + app или только postgres для разработки).
- **Стандарты:** DEVELOPMENT.md, `.cursor/rules/development-standards.mdc` — роли, принципы (team_id, транзакции, валидация), чек-лист перед коммитом.

### Что осталось по текущему плану

- **Фаза 2:** тест на своей команде, исправление критических ошибок (ручной шаг).
- **Фаза 4:** мультитенантность (несколько команд на одного пользователя веб-админки), тесты, бэкапы, документация для пользователей. Реализовано: роли в боте (меню по ролям), веб-админка (Участники с именами и @username, Приглашения с QR, Настройки с @username для доступа в бот), отметка оплаты.

---

## План дальнейшего развития

### Фаза 4 (недели 7–8): Упаковка и запуск

**Цель:** продукт, готовый к безопасной эксплуатации (без интеграции платёжных систем).

| Направление | Задачи |
|-------------|--------|
| **Мультитенантность и роли** | Разделение по командам уже есть (team_id). Добавить роли: админ команды, капитан, игрок — и проверки прав (кто может вводить результат, выставлять долги, публиковать в канал). |
| **Отметка об оплате** | Только учёт: возможность отмечать, что игрок оплатил (кнопка/команда «оплатил», сброс долга или отдельный флаг). Без ЮKassa, CloudPayments и т.п. |
| **Админ-панель (Web)** | Простой Spring MVC или SPA: дашборд команды, просмотр состава и статистики, редактирование игроков и матчей. |
| **Надёжность** | Нагрузочное тестирование, проверка разграничения доступа, регулярные бэкапы PostgreSQL (cron + pg_dump или средства облака). |
| **Запуск** | Документация для пользователей, инструкция по развёртыванию, подготовка к публичному запуску. |

При нехватке времени приоритет: мультитенантность/роли и отметка об оплате; админ-панель можно вынести в следующий спринт.

### После Фазы 4 (идеи на будущее)

- **Статистика игроков в матчах** — таблица player_stats (очки, подборы, передачи и т.д.), ввод после матча или через бота/веб.
- **Расширение контента** — другие форматы постов, шаблоны под VK/другие соцсети.
- **Уведомления** — напоминания об оплате, уведомления о смене статуса игрока (опционально).
- **Мобильное/веб-приложение** — кабинет игрока/менеджера вне Telegram (по необходимости).

---

## Ссылки

- [ROLES.md](ROLES.md) — роли в боте и веб-админке, кто что может.
- [ROADMAP.md](../ROADMAP.md) — чек-листы по фазам.
- [План разработки](../План%20разработки) — полный понедельный план и риски.
- [DEVELOPMENT.md](../DEVELOPMENT.md) — стандарты разработки.
- [README.md](../README.md) — быстрый старт и структура проекта.
