# Цифровой менеджер — общая картина и план развития

## Что сделано (общая картина)

**Цифровой менеджер** — Telegram-бот для баскетбольной команды. Один чат = одна команда: менеджер создаёт команду по `/start`, добавляет игроков и матчи, вводит результаты; бот генерирует посты и картинки, напоминает о матчах и собирает явку.

### Реализованный функционал

| Область | Что сделано |
|--------|--------------|
| **Ядро** | Spring Boot 3, PostgreSQL, Flyway, JPA (Team, Player, Match). Везде фильтрация по `team_id`. |
| **Бот** | `/start` → создание команды по следующему сообщению. Меню (кнопки): Состав, Добавить игрока, Новый матч, Ввести результат, Опрос, Долги. |
| **Игроки** | Добавление (/addplayer Имя Номер), состав с фильтром по статусу. Статусы: активен, травма, отпуск, не оплатил (`/setstatus`, `/roster активные` и т.д.). |
| **Матчи** | Создание (/newmatch Соперник), ввод результата (/result наши их). Сохранение в БД, статусы матча (запланирован / завершён / отменён). |
| **Контент** | После ввода результата — текст поста по шаблону и карточка 1080×1080 PNG в чат. Кнопка «Опубликовать в канал» и команда `/setchannel ID` для привязки канала. |
| **Явка и финансы** | Опрос на игру (/poll текст) — Еду / Не еду / Опоздаю. Долги: `/debt`, `/setdebt Имя Сумма`. |
| **Напоминания** | Планировщик (каждые 15 мин): за 24 ч — сообщение с кнопками «Буду / Опоздаю / Не смогу», через ~2 ч — статистика явки в чат; за 3 ч — напоминание о матче; после матча — напоминание ввести результат; еженедельно — напоминание о долгах. |
| **Роли** | В боте: ADMIN, PLAYER; меню кнопок зависит от роли. В веб-админке: Участники (имя, @username, роли, долг, участие в матчах с возможностью отменить), Приглашения (ссылка и QR), Настройки (канал, Telegram администратора). |
| **Явка на матч** | Подтверждения (event_attendance) по кнопкам в чате. В админке: в карточке матча — состав по подтверждениям (Буду / Опоздаю / Не смогу / Не ответили), отмена участия; в профиле участника — список предстоящих матчей и кнопка «Отменить участие». |
| **Интеграция и метрики** | Таблица `integration_event`: каждая отправка в Telegram (ответы бота, напоминания, QR приглашения, опросы) записывается с результатом (успех/ошибка). В админке страница **Интеграция** — сводка за период (всего/доставлено/ошибки), разбивка по типу события, лог последних событий. |

### Технический стек и инфраструктура

- **Backend:** Java 17, Spring Boot 3.2, Spring Data JPA, Flyway.
- **БД:** PostgreSQL, Flyway V1–V18 (схема, долги/канал, статусы, напоминания, роли, приглашения, system_settings, явка на матч, статистика напоминаний, турнирная таблица, события, финансы, интеграция integration_event).
- **Telegram:** telegrambots (long polling), один бот, один клиент (бин) для бота и планировщика.
- **Запуск:** локально (Maven), Docker (postgres + app или только postgres для разработки).
- **Стандарты:** DEVELOPMENT.md, `.cursor/rules/development-standards.mdc` — роли, принципы (team_id, транзакции, валидация), чек-лист перед коммитом.

### Что осталось по текущему плану

- **Фаза 2:** тест на своей команде, исправление критических ошибок (ручной шаг).
- **Фаза 4:** мультитенантность (несколько команд на одного пользователя веб-админки), тесты, бэкапы, документация для пользователей. Реализовано: роли в боте (меню по ролям), веб-админка (Участники с именами и @username, Приглашения с QR, Настройки с @username для доступа в бот), отметка оплаты.

---

## План дальнейшего развития

### Фаза 4 (недели 7–8): Упаковка и запуск

**Цель:** продукт, готовый к безопасной эксплуатации (без интеграции платёжных систем).

| Направление | Задачи |
|-------------|--------|
| **Мультитенантность и роли** | Разделение по командам уже есть (team_id). Добавить роли: админ команды, капитан, игрок — и проверки прав (кто может вводить результат, выставлять долги, публиковать в канал). |
| **Отметка об оплате** | Только учёт: возможность отмечать, что игрок оплатил (кнопка/команда «оплатил», сброс долга или отдельный флаг). Без ЮKassa, CloudPayments и т.п. |
| **Админ-панель (Web)** | Простой Spring MVC или SPA: дашборд команды, просмотр состава и статистики, редактирование игроков и матчей. |
| **Надёжность** | Нагрузочное тестирование, проверка разграничения доступа, регулярные бэкапы PostgreSQL (cron + pg_dump или средства облака). |
| **Запуск** | Документация для пользователей, инструкция по развёртыванию, подготовка к публичному запуску. |

При нехватке времени приоритет: мультитенантность/роли и отметка об оплате; админ-панель можно вынести в следующий спринт.

### После Фазы 4 (идеи на будущее)

- **Статистика игроков в матчах** — таблица player_stats (очки, подборы, передачи и т.д.), ввод после матча или через бота/веб.
- **Расширение контента** — другие форматы постов, шаблоны под VK/другие соцсети.
- **Уведомления** — напоминания об оплате, уведомления о смене статуса игрока (опционально).
- **Мобильное/веб-приложение** — кабинет игрока/менеджера вне Telegram (по необходимости).

---

## Ссылки

- [BOT_COMMANDS.md](BOT_COMMANDS.md) — все команды бота и как они работают (справочник).
- [ROLES.md](ROLES.md) — роли в боте и веб-админке, кто что может.
- [ROADMAP.md](../ROADMAP.md) — чек-листы по фазам.
- [План разработки](../План%20разработки) — полный понедельный план и риски.
- [DEVELOPMENT.md](../DEVELOPMENT.md) — стандарты разработки.
- [README.md](../README.md) — быстрый старт и структура проекта.
