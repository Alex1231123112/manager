# Роли и разграничение доступа

В системе есть роли участников команды в **Telegram-боте** и единый доступ **веб-админки**. Отдельно задаётся **системный администратор** (один Telegram ID), который может создавать новую команду в боте без приглашения.

---

## Создание новой команды в боте (без приглашения)

Создать новую команду по `/start` (без кода приглашения) может **только один пользователь** — тот, чей **Telegram ID** указан в веб-админке в настройках («Доступ в бот» → «Telegram ID администратора»). Если значение не задано или не совпадает с отправителем, бот не даёт создать команду и просит получить ссылку-приглашение у менеджера команды. Остальные участники попадают в команду только по приглашению (ссылка или `/start CODE`).

---

## Роли в боте (на команду)

Участники чата команды могут иметь одну из ролей:

| Роль     | Уровень | Возможности |
|----------|--------|-------------|
| **ADMIN**  | 3 | Всё, что CAPTAIN, плюс назначение ролей другим (/setrole). Создатель команды получает ADMIN. |
| **CAPTAIN**| 2 | Добавление игроков, создание матчей, ввод результата, долги, канал, статусы игроков, кнопка «Оплатил» в списке долгов. |
| **PLAYER** | 1 | Просмотр состава (/roster), опросы (/poll), просмотр долгов. Не может вводить результат, выставлять долги, публиковать в канал. |

- Если в команде **нет записей** в `team_members` (старые команды), любой участник чата считается админом (legacy).
- Назначение роли: в боте команда **/setrole** `TelegramID` `ADMIN|CAPTAIN|PLAYER` (только админ). Пример: `/setrole 123456789 CAPTAIN`.
- Создание приглашений: кнопка **Приглашение** или **/invite** (и опционально `/invite PLAYER|CAPTAIN|ADMIN`) — только капитан и админ.
- Узнать свой Telegram ID можно у бота @userinfobot или в настройках клиента.

---

## Веб-админка

- Вход по логину/паролю из конфига (по умолчанию **admin** / **admin**). Один учётный запись = полный доступ ко всем командам, к которым есть доступ по данным (все команды в БД).
- В веб-админке можно:
  - Выбрать команду и видеть дашборд, состав, матчи, долги, настройки.
  - На странице **«Участники»** — просматривать список участников команды (Telegram ID + роль) и **менять им роли** (выпадающий список). Это те же роли, что и в боте: смена в админке сразу влияет на права в Telegram.

---

## Кто что может

| Действие | В боте | В веб-админке |
|----------|--------|----------------|
| Просмотр состава, матчей, долгов | Все (PLAYER и выше) | Любой вошедший |
| Добавить игрока, матч, ввести результат | CAPTAIN, ADMIN | Любой вошедший |
| Выставить долг, отметить «оплатил», задать канал | CAPTAIN, ADMIN | Любой вошедший |
| Опубликовать карточку в канал | CAPTAIN, ADMIN | Любой вошедший |
| Назначить роль участнику (/setrole) | Только ADMIN | Любой вошедший (страница «Участники») |
| Опрос на игру (/poll) | Все | — |

Итог: в боте права ограничены ролями; в веб-админке один общий логин с полным доступом, плюс возможность просматривать и редактировать роли участников бота.
