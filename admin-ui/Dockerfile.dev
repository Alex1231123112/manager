# Режим разработки: код монтируется из хоста, node_modules — свой в контейнере (Linux).
# Используем Debian (glibc), не Alpine (musl): lightningcss на musl часто не ставит optional-зависимость.
FROM node:20-bookworm-slim
WORKDIR /app

# Polling нужен, чтобы в Docker подхватывались изменения файлов на хосте
ENV CHOKIDAR_USEPOLLING=true
ENV WATCHPACK_POLLING=true
ENV NEXT_PUBLIC_API_URL=http://localhost:8095

COPY package.json package-lock.json* ./
RUN npm ci

COPY docker-dev-entrypoint.sh /docker-dev-entrypoint.sh
RUN chmod +x /docker-dev-entrypoint.sh

EXPOSE 3000
ENV PORT=3000
ENV HOSTNAME="0.0.0.0"
ENTRYPOINT ["/docker-dev-entrypoint.sh"]
